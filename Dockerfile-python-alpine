# -------------------------
# Builder stage
# -------------------------
FROM python:alpine AS builder

# Install required tools
RUN apk add --no-cache curl ca-certificates

# Install Poetry into /etc/poetry (includes its own musl Python)
RUN curl -sSL https://install.python-poetry.org | \
    POETRY_HOME=/etc/poetry python3 -

# -------------------------
# Final stage
# -------------------------
FROM python:alpine

# Copy Poetry from builder
COPY --from=builder /etc/poetry /etc/poetry

# Make poetry available on PATH
RUN ln -s /etc/poetry/venv/bin/poetry /usr/local/bin/poetry

# Optional sanity check
RUN /usr/local/bin/poetry --version
